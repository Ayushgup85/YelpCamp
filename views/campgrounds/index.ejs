<% layout('layouts/boilerplate') %>

<link rel="stylesheet" href="/stylesheets/campgrounds.css" />
<div id="carouselPreview" class="carousel slide" data-bs-ride="carousel">
  <ol class="carousel-indicators">
    <li data-bs-target="#carouselPreview" data-bs-slide-to="0" class="active"></li>
    <li data-bs-target="#carouselPreview" data-bs-slide-to="1"></li>
    <li data-bs-target="#carouselPreview" data-bs-slide-to="2"></li>
    <li data-bs-target="#carouselPreview" data-bs-slide-to="3"></li>
    <li data-bs-target="#carouselPreview" data-bs-slide-to="4"></li>
    <li data-bs-target="#carouselPreview" data-bs-slide-to="5"></li>
  </ol>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img class="img-responsive preview" src="/assets/carousel1.jpg" alt="First slide" />
      <div class="carousel-caption d-none d-md-block">
        <h1>Yelpcamp</h1>
        <p>View Campgrounds from all over the world</p>
      </div>
    </div>
    <div class="carousel-item">
      <img class="img-responsive preview" src="/assets/carousel2.jpg" alt="Second slide" />
      <div class="carousel-caption d-none d-md-block">
        <h1>Beautiful Night Views</h1>
      </div>
    </div>
    <div class="carousel-item">
      <img class="img-responsive preview" src="/assets/carousel3.jpg" alt="Third slide" />
      <div class="carousel-caption d-none d-md-block">
        <h1>Rediscover Nature</h1>
      </div>
    </div>
    <div class="carousel-item">
      <img class="img-responsive preview" src="/assets/carousel4.jpg" alt="Fourth slide" />
      <div class="carousel-caption d-none d-md-block">
        <h1>Breathtaking Views</h1>
      </div>
    </div>
    <div class="carousel-item">
      <img class="img-responsive preview" src="/assets/carousel5.jpg" alt="Fifth slide" />
      <div class="carousel-caption d-none d-md-block">
        <h1>Spend Time with Loved Ones</h1>
      </div>
    </div>
    <div class="carousel-item">
      <img class="img-responsive preview" src="/assets/carousel6.jpg" alt="Sixth slide" />
      <div class="carousel-caption d-none d-md-block">
        <h1>Experience Camping to it's Fullest</h1>
      </div>
    </div>
  </div>
  <a class="carousel-control-prev" href="#carouselPreview" role="button" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#carouselPreview" role="button" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div>
<%- include('../partials/flash') %>
<div class="container">
  <div class="row d-flex flex-wrap">
    <% campgrounds.forEach(function(campground){ %>
    <div class="col-sm-12 col-md-6 col-lg-4 pb-5 indexCards">
      <div class="card thumbnail shadow border-0 mt-4">
        <a href="/campgrounds/<%= campground._id %>">
          <img src="<%= campground.images[0].url %>" class="img-fluid rounded" />
        </a>

        <% if(campground.price>= 40){ %>
        <% var rate="$$$" %>
        <% } else if (campground.price>= 20){ %>
        <% var rate="$$" %>
        <% } else { %>
        <% var rate="$" %>
        <% } %>

        <div class="card-body">
          <h6 class="card-title text-capitalize fw-normal">
            <% if(currentUser){ %>
            <%# if(campground.likes.includes(currentUser._id.toString())){ %>
            <!-- <a class="fs-2" href="/campgrounds/<%# campground._id %>">
              <%# campground.name %>
            </a>
            <i class="fa fa-heart icon" id="icons" campgroundId="<%# campground._id %>" aria-hidden="true"></i>
            <span class="float-end text-muted">
              <%# rate %>
            </span> -->
            <%# } else{ %>
            <a class="fs-2" href="/campgrounds/<%= campground._id %>">
              <%= campground.name %>
            </a>
            <i class="fa fa-heart-o icon-o" id="icons" campgroundId="<%= campground._id %>" aria-hidden="true"></i>
            <span class="float-end text-muted">
              <%= rate %>
            </span>
            <%# } %>
            <% } else{ %>
            <a class="fs-2" href="/campgrounds/<%= campground._id %>">
              <%= campground.name %>
            </a>
            <span class="float-end text-muted">
              <%= rate %>
            </span>
            <% } %>
          </h6>

          <div class="card-subtitle d-flex align-items-center">
            <% if(campground.reviews.length){ %>

            <% if(campground.reviews.length==1){ %>
            <span class="text-muted fs-6">
              1 review
            </span>
            <% } else { %>
            <span class="text-muted fs-6">
              <%= campground.reviews.length %> reviews
            </span>
            <% } %>

            <div class="Stars ms-2" style="--rating: <%= campground.rating/campground.reviews.length || 0 %> ;"
              aria-label="Rating of the Campground"></div>
            <% } else { %>
            <spam class="text-muted">0 Reviews </spam>
            <% } %>
          </div>

        </div>
      </div>
    </div>
    <% }) %>
  </div>
</div>
<script src="https://unpkg.com/scrollreveal"></script>
<script>
  ScrollReveal().reveal(".indexCards", {
    interval: 100,
    mobile: true,
    viewFactor: 0.5,
  });
</script>
<script>
  $("i.icon-o").click(function () {
    var campgroundId = $(this).attr("campgroundId");
    $.ajax({
        method: "POST",
        url: "/save",
        data: {
          campgroundId: campgroundId
        },
      })
      .done((res) => {
        $(this).removeClass("fa-heart-o");
        $(this).addClass("fa-heart");
      })
      .fail(function (err) {
        console.log(err);
        alert("See Console");
      });
  });
</script>